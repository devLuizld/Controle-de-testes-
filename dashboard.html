<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Testes - Botânica Bistrô</title>
<link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Tulipa_green_icon.svg/1024px-Tulipa_green_icon.svg.png" type="image/png">
<style>
body { font-family: 'Poppins', sans-serif; background-color: #f0f9f0; margin:0; padding:20px; }
h1 { text-align:center; color:#2E7D32; }
#formulario input, #formulario select, #formulario button { padding:5px; margin:5px; }
#formulario button { cursor:pointer; background:#4CAF50; color:white; border:none; border-radius:6px; }
table { width:100%; border-collapse: collapse; margin-top:20px; background:#fff; box-shadow:0 0 10px rgba(0,0,0,0.1);}
th, td { border:1px solid #ddd; padding:10px; text-align:center;}
th { background:#4CAF50; color:white; }
tr:nth-child(even){ background:#f2f2f2; }

.btn { padding:5px 10px; margin:2px; border:none; border-radius:6px; cursor:pointer; color:white; }
.aprovado { background:#4CAF50; }
.reprovado { background:#f44336; }
.em-teste { background:#FF9800; }
.excluir { background:#9E9E9E; }
.mais-dia { background:#2196F3; }

@media (max-width: 768px) {
    table, thead, tbody, th, td, tr { display:block; }
    th { display:none; }
    tr { margin-bottom:15px; border:1px solid #ddd; border-radius:10px; padding:10px; background:#fff; }
    td { border:none; padding:5px; text-align:right; position: relative; }
    td::before { content: attr(data-label); position: absolute; left:10px; width: 45%; font-weight:bold; text-align:left; }
    #formulario input, #formulario select, #formulario button { width:100%; box-sizing:border-box; }
}
</style>
</head>
<body>

<h1>Controle de Testes - Botânica Bistrô</h1>

<div id="formulario">
    <input type="text" id="nome" placeholder="Nome do Candidato" required>
    <select id="cargo">
        <option value="">Selecione Cargo</option>
        <option>Auxiliar de Atendimento</option>
        <option>Auxiliar de Cozinha</option>
        <option>Auxiliar de Serviços Gerais</option>
        <option>Auxiliar de Confeitaria</option>
    </select>
    <select id="unidade">
        <option value="">Selecione Unidade</option>
        <option>Gávea</option>
        <option>Jardim Botânico</option>
        <option>Botafogo</option>
        <option>Tijuca</option>
    </select>
    <input type="number" id="dias" placeholder="Dias de Teste" min="1" required>
    <input type="date" id="data" required>
    <input type="text" id="horario" placeholder="Horário (Ex: 09h-12h)" required>
    <select id="status">
        <option value="Em Teste">Em Teste</option>
        <option value="Aprovado">Aprovado</option>
        <option value="Reprovado">Reprovado</option>
    </select>
    <button id="btnAdicionar">Adicionar Candidato</button>
</div>

<table id="tabelaCandidatos">
    <thead>
        <tr>
            <th>Nome</th>
            <th>Cargo</th>
            <th>Unidade</th>
            <th>Dias</th>
            <th>Data</th>
            <th>Horários</th>
            <th>Status</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwusOEWLXAlDZu1ncOfRc34lQhvxgbPohhZOHAtiggZenMJNGn7h4c7AE_z6RqXUPjS/exec";

// Formata data DD/MM/YYYY
function formatarData(valor){
    if(!valor) return "";
    const d = new Date(valor);
    if(!isNaN(d)) return d.toLocaleDateString('pt-BR');
    return valor;
}

// Classe de status
function statusClass(status){
    if(status === "Aprovado") return "aprovado";
    if(status === "Reprovado") return "reprovado";
    return "em-teste";
}

// Carrega candidatos
async function carregarCandidatos(){
    const tbody = document.querySelector("#tabelaCandidatos tbody");
    tbody.innerHTML = "";
    try{
        const resp = await fetch(API_URL + "?acao=list"); // Garantir ação de listar
        const dados = await resp.json();
        dados.forEach(c => {
            const tr = document.createElement("tr");
            tr.dataset.row = c.rowNumber;
            const horario = c.Horários || c.Horario || "";
            tr.innerHTML = `
                <td data-label="Nome">${c.Nome || ""}</td>
                <td data-label="Cargo">${c.Cargo || ""}</td>
                <td data-label="Unidade">${c.Unidade || ""}</td>
                <td data-label="Dias">${c.Dias || ""}</td>
                <td data-label="Data">${formatarData(c.Data)}</td>
                <td data-label="Horários">${horario}</td>
                <td data-label="Status"><span class="btn ${statusClass(c.Status)}">${c.Status}</span></td>
                <td data-label="Ações">
                    <button class="btn aprovado" onclick="mudarStatus(${c.rowNumber},'Aprovado')">Aprovado</button>
                    <button class="btn reprovado" onclick="mudarStatus(${c.rowNumber},'Reprovado')">Reprovado</button>
                    <button class="btn em-teste" onclick="mudarStatus(${c.rowNumber},'Em Teste')">Em Teste</button>
                    <button class="btn mais-dia" onclick="adicionarUmDia(${c.rowNumber})">+1 dia</button>
                    <button class="btn excluir" onclick="excluirCandidato(${c.rowNumber})">Excluir</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }catch(err){
        console.error("Erro ao carregar:",err);
    }
}

// Adicionar candidato
async function adicionarCandidato(){
    const nome = document.getElementById('nome').value.trim();
    const cargo = document.getElementById('cargo').value.trim();
    const unidade = document.getElementById('unidade').value.trim();
    const dias = document.getElementById('dias').value;
    const data = document.getElementById('data').value;
    const horario = document.getElementById('horario').value.trim();
    const status = document.getElementById('status').value;

    if(!nome || !cargo || !unidade || !dias || !data || !horario || !status){
        alert("Preencha todos os campos!");
        return;
    }

    const params = {
        acao: "add",
        Nome: nome,
        Cargo: cargo,
        Unidade: unidade,
        Dias: dias,
        Data: data,
        Horários: horario,
        Status: status
    };

    try {
        await fetch(API_URL,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify(params)
        });
        limparFormulario();
        carregarCandidatos();
    } catch(e){
        console.error("Erro ao adicionar candidato:", e);
        alert("Erro ao adicionar candidato. Confira console.");
    }
}

function limparFormulario(){
    document.getElementById('nome').value="";
    document.getElementById('cargo').value="";
    document.getElementById('unidade').value="";
    document.getElementById('dias').value="";
    document.getElementById('data').value="";
    document.getElementById('horario').value="";
    document.getElementById('status').value="Em Teste";
}

// Mudar status
async function mudarStatus(rowNumber, novoStatus){
    await fetch(API_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
            acao:"update",
            rowNumber,
            campo:"Status",
            valor: novoStatus
        })
    });
    carregarCandidatos();
}

// Adicionar +1 dia
async function adicionarUmDia(rowNumber){
    const resp = await fetch(API_URL + "?acao=list");
    const dados = await resp.json();
    const candidato = dados.find(c => c.rowNumber === rowNumber);
    if(!candidato) return;
    const dataAtual = new Date(candidato.Data);
    dataAtual.setDate(dataAtual.getDate() + 1);
    const dataFormatada = dataAtual.toISOString().split("T")[0];

    await fetch(API_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
            acao:"update",
            rowNumber,
            campo:"Data",
            valor: dataFormatada
        })
    });
    carregarCandidatos();
}

// Excluir candidato
async function excluirCandidato(rowNumber){
    await fetch(API_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
            acao:"delete",
            rowNumber
        })
    });
    carregarCandidatos();
}

// Inicialização
document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("btnAdicionar").addEventListener("click", adicionarCandidato);
    carregarCandidatos();
});
</script>

</body>
</html>
