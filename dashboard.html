<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Testes - Botânica Bistrô</title>
<link rel="icon" href="https://static.thenounproject.com/png/green-flower-icon-3807932-512.png" type="image/png">
<style>
    body { font-family: 'Poppins', sans-serif; background-color: #f5f5f5; margin:0; padding:20px; }
    h1 { text-align:center; color:#2E7D32; }
    #formulario input, #formulario select { padding:5px; margin:5px; }
    #formulario button { padding:5px 10px; margin:5px; }
    table { width:100%; border-collapse: collapse; margin-top:20px; background:#fff; box-shadow:0 0 10px rgba(0,0,0,0.1);}
    th, td { border:1px solid #ddd; padding:10px; text-align:center;}
    th { background:#4CAF50; color:white; }
    tr:nth-child(even){ background:#f2f2f2; }
    .btn { padding:5px 10px; margin:2px; border:none; border-radius:6px; cursor:pointer; color:white; }
    .aprovado { background:#4CAF50; }
    .reprovado { background:#f44336; }
    .em-teste { background:#FF9800; }
    .excluir { background:#9E9E9E; }

    @media (max-width: 768px) {
        table, thead, tbody, th, td, tr { display:block; }
        th { display:none; }
        tr { margin-bottom:15px; border:1px solid #ddd; border-radius:10px; padding:10px; background:#fff; }
        td { border:none; padding:5px; text-align:right; position: relative; }
        td::before { content: attr(data-label); position: absolute; left:10px; width: 45%; font-weight:bold; text-align:left; }
        #formulario input, #formulario select, #formulario button { width:100%; box-sizing:border-box; }
        .btn { font-size:12px; padding:4px 8px; margin:2px; }
    }
</style>
<!-- Firebase compat scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

<h1>Controle de Testes - Botânica Bistrô</h1>

<div id="formulario">
    <input type="text" id="nome" placeholder="Nome do Candidato" required>
    <select id="cargo">
        <option value="">Selecione Cargo</option>
        <option>Auxiliar de Atendimento</option>
        <option>Auxiliar de Cozinha</option>
        <option>Auxiliar de Serviços Gerais</option>
        <option>Auxiliar de Confeitaria</option>
    </select>
    <select id="unidade">
        <option value="">Selecione Unidade</option>
        <option>Gávea</option>
        <option>Jardim Botânico</option>
        <option>Botafogo</option>
        <option>Tijuca</option>
    </select>
    <input type="number" id="dias" placeholder="Dias de Teste" min="1" required>
    <input type="date" id="data" required>
    <input type="text" id="horario" placeholder="Horário (Ex: 09h-12h)" required>
    <select id="status">
        <option value="Em Teste">Em Teste</option>
        <option value="Aprovado">Aprovado</option>
        <option value="Reprovado">Reprovado</option>
    </select>
    <button onclick="adicionarCandidato()">Adicionar Candidato</button>

    <select id="filtroUnidade" onchange="filtrarCandidatos()">
        <option value="">Filtrar por Unidade</option>
        <option>Gávea</option>
        <option>Jardim Botânico</option>
        <option>Botafogo</option>
        <option>Tijuca</option>
    </select>
</div>

<table id="tabelaCandidatos">
    <thead>
        <tr>
            <th>Nome</th>
            <th>Cargo</th>
            <th>Unidade</th>
            <th>Data</th>
            <th>Horário</th>
            <th>Dias de Teste</th>
            <th>Status</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyC7b7aO7_LBCk2-HGPHMj1DB1Haty8eruc",
    authDomain: "controle-de-testes.firebaseapp.com",
    projectId: "controle-de-testes",
    storageBucket: "controle-de-testes.appspot.com",
    messagingSenderId: "624074959757",
    appId: "1:624074959757:web:604ed8e19227181fe8ebc4",
    measurementId: "G-H8L8DMH6R2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function formatarData(dataStr){
    const data = new Date(dataStr);
    const dia = String(data.getDate()).padStart(2,'0');
    const mes = String(data.getMonth()+1).padStart(2,'0');
    const ano = data.getFullYear();
    return `${dia}/${mes}/${ano}`;
}

async function adicionarCandidato() {
    const nome = document.getElementById('nome').value;
    const cargo = document.getElementById('cargo').value;
    const unidade = document.getElementById('unidade').value;
    const dias = parseInt(document.getElementById('dias').value);
    const data = document.getElementById('data').value;
    const horario = document.getElementById('horario').value;
    const status = document.getElementById('status').value;

    if(!nome || !cargo || !unidade || !dias || !data || !horario || !status) {
        alert("Preencha todos os campos!");
        return;
    }

    try {
        await db.collection("candidatos").add({ nome, cargo, unidade, dias, data, horario, status });
        limparFormulario();
    } catch (e) {
        console.error("Erro ao adicionar candidato: ", e);
        alert("Erro ao adicionar candidato. Veja o console.");
    }
}

function limparFormulario() {
    document.getElementById('nome').value = '';
    document.getElementById('cargo').value = '';
    document.getElementById('unidade').value = '';
    document.getElementById('dias').value = '';
    document.getElementById('data').value = '';
    document.getElementById('horario').value = '';
    document.getElementById('status').value = 'Em Teste';
}

function carregarCandidatos(){
    const tbody = document.querySelector("#tabelaCandidatos tbody");

    db.collection("candidatos").onSnapshot((querySnapshot) => {
        tbody.innerHTML = "";
        const filtro = document.getElementById('filtroUnidade').value;
        querySnapshot.forEach((docSnap) => {
            const c = docSnap.data();
            if(filtro && c.unidade !== filtro) return;

            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td data-label="Nome">${c.nome}</td>
                <td data-label="Cargo">${c.cargo}</td>
                <td data-label="Unidade">${c.unidade}</td>
                <td data-label="Data">${formatarData(c.data)}</td>
                <td data-label="Horário">${c.horario}</td>
                <td data-label="Dias de Teste">${c.dias}</td>
                <td data-label="Status" class="${c.status==='Aprovado'?'aprovado':c.status==='Reprovado'?'reprovado':'em-teste'}">${c.status}</td>
                <td data-label="Ações">
                    <button class="btn em-teste" onclick="incrementarDias('${docSnap.id}', ${c.dias})">+1 Dia</button>
                    <button class="btn aprovado" onclick="alterarStatus('${docSnap.id}','Aprovado')">Aprovado</button>
                    <button class="btn reprovado" onclick="alterarStatus('${docSnap.id}','Reprovado')">Reprovado</button>
                    <button class="btn em-teste" onclick="alterarStatus('${docSnap.id}','Em Teste')">Em Teste</button>
                    <button class="btn excluir" onclick="excluirCandidato('${docSnap.id}')">Excluir</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    });
}

async function incrementarDias(id, dias){
    const docRef = db.collection("candidatos").doc(id);
    const novaData = new Date();
    await docRef.update({
        dias: dias + 1,
        data: novaData.toISOString().split('T')[0]
    });
}

async function alterarStatus(id, novoStatus){
    const docRef = db.collection("candidatos").doc(id);
    await docRef.update({status: novoStatus});
}

async function excluirCandidato(id){
    if(confirm("Tem certeza que deseja excluir este candidato?")){
        await db.collection("candidatos").doc(id).delete();
    }
}

function filtrarCandidatos() {
    carregarCandidatos();
}

// Inicializa o listener
carregarCandidatos();
</script>
</body>
</html>
